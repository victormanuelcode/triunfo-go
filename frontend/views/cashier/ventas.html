<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ventas - TRIUNFO GO</title>
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/ventas.css">
</head>
<body>
    <script>
        if (!localStorage.getItem('sesion_activa')) {
            window.location.href = '../auth/login.html';
        }
    </script>

    <header class="main-header">
        <div class="header-content">
            <div class="logo">TRIUNFO GO</div>
            <nav class="main-nav">
                <a href="ventas.html" class="active">Ventas</a>
                <a href="#" onclick="mostrarModalCierreCaja()">Caja</a>
                <!-- El cajero puede ver el historial global o solo el suyo. Por ahora enlazamos al global pero con ruta relativa -->
                <a href="../admin/historial.html">Historial</a>
                <a href="#" id="logoutBtn">Salir</a>
            </nav>
        </div>
    </header>

    <div class="pos-container">
        <!-- Panel Izquierdo: Catálogo -->
        <div class="catalog-section">
            <div class="search-bar">
                <input type="text" id="buscador" placeholder="Buscar producto por nombre..." onkeyup="filtrarProductos()">
            </div>
            <div class="catalog-grid" id="productos-catalogo">
                <div class="loading-spinner">Cargando productos...</div>
            </div>
        </div>

        <!-- Panel Derecho: Carrito -->
        <div class="cart-section">
            <div class="cart-header">
                <h3>Nueva Venta</h3>
                <div style="margin: 10px 0;">
                    <select id="cliente-select" style="width: 100%; padding: 8px; margin-bottom: 5px;">
                        <option value="">Cargando clientes...</option>
                    </select>
                    <small><a href="../admin/clientes.html" target="_blank">Gestionar Clientes</a></small>
                </div>
                <span id="fecha-actual"></span>
            </div>
            
            <div class="cart-items" id="carrito-items">
                <!-- Items agregados aparecerán aquí -->
                <div class="empty-cart-msg">El carrito está vacío</div>
            </div>

            <div class="cart-footer">
                <div class="cart-total">
                    <span>Total:</span>
                    <span id="total-amount">$0</span>
                </div>
                <button class="btn-checkout" onclick="procesarVenta()">Finalizar Venta</button>
            </div>
        </div>
    </div>

    <div id="modal-apertura-caja" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
        <div class="modal-content" style="background:white; padding:30px; border-radius:8px; width:400px; text-align:center;">
            <h2>Apertura de Caja</h2>
            <p>Debes abrir caja para comenzar a vender.</p>
            <div class="form-group" style="margin: 20px 0;">
                <label>Monto Inicial (Base):</label>
                <input type="number" id="monto-apertura" class="form-control" value="0" min="0" style="width:100%; padding:10px; margin-top:5px; font-size:1.2em;">
            </div>
            <button onclick="abrirCaja()" class="btn-primary" style="width:100%; padding:10px; font-size:1.1em;">Abrir Caja</button>
        </div>
    </div>

    <div id="modal-cierre-caja" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
        <div class="modal-content" style="background:white; padding:30px; border-radius:8px; width:400px;">
            <h2 style="text-align:center;">Cierre de Caja</h2>
            
            <div style="background:#f8f9fa; padding:15px; margin:15px 0; border-radius:5px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span>Monto Inicial:</span>
                    <strong id="cierre-inicial">$0</strong>
                </div>
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span>Ventas (Sistema):</span>
                    <strong id="cierre-ventas">$0</strong>
                </div>
                <div style="display:flex; justify-content:space-between; border-top:1px solid #ccc; padding-top:10px;">
                    <span>Total Esperado:</span>
                    <strong id="cierre-esperado" style="color:green; font-size:1.2em;">$0</strong>
                </div>
            </div>

            <div class="form-group">
                <label>Dinero en Efectivo (Real):</label>
                <input type="number" id="monto-cierre" class="form-control" placeholder="Monto contado..." style="width:100%; padding:10px; font-size:1.2em;">
            </div>
            
            <div style="margin-top:20px; display:flex; gap:10px;">
                <button onclick="cerrarModalCierre()" style="flex:1; padding:10px; background:#6c757d; color:white; border:none; border-radius:4px;">Cancelar</button>
                <button onclick="procesarCierreCaja()" style="flex:1; padding:10px; background:#dc3545; color:white; border:none; border-radius:4px;">Cerrar Caja</button>
            </div>
        </div>
    </div>

    <script src="../../js/ventas.js"></script>
    <script>
        function logout() {
            localStorage.clear();
            window.location.href = '../auth/login.html';
        }
        document.getElementById('fecha-actual').innerText = new Date().toLocaleDateString();
    </script>
</body>
</html>
